<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotating Line with Color Change</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>

<canvas id="myCanvas" width="400" height="400"></canvas>

<script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    const lineLength = 50;
    const circleRadius = 10;
    const baseX = canvas.width / 2;
    const baseY = canvas.height / 2 + 100;
    let angle = 0; // initial angle (in radians)
    let dragging = false;

    // Circle for color changing
    const bigCircle = {
        x: baseX,
        y: baseY + 150,
        radius: 100,
        color: 'red'
    };

    function drawLineWithCircle() {
        // Calculate the top point of the line based on the current angle
        const endX = baseX + lineLength * Math.cos(angle);
        const endY = baseY - lineLength * Math.sin(angle);

        // Clear the canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw the big color-changing circle
        ctx.beginPath();
        ctx.arc(bigCircle.x, bigCircle.y, bigCircle.radius, 0, 2 * Math.PI);
        ctx.fillStyle = bigCircle.color;
        ctx.fill();

        // Draw the line
        ctx.beginPath();
        ctx.moveTo(baseX, baseY);
        ctx.lineTo(endX, endY);
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Draw the small circle at the top of the line
        ctx.beginPath();
        ctx.arc(endX, endY, circleRadius, 0, 2 * Math.PI);
        ctx.fillStyle = 'black';
        ctx.fill();
    }

    // Function to calculate color based on angle
    function updateColor() {
        const degrees = (angle * 180 / Math.PI); // convert radians to degrees (0 to 180)
        const percentage = degrees / 180;
        const red = Math.round(255 * (1 - percentage));
        const blue = Math.round(255 * percentage);
        bigCircle.color = `rgb(${red}, 0, ${blue})`;
    }

    // Handle mouse down event
    canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;

        const endX = baseX + lineLength * Math.cos(angle);
        const endY = baseY - lineLength * Math.sin(angle);

        // Check if the mouse is within the small circle at the top of the line
        const distance = Math.sqrt((mouseX - endX) ** 2 + (mouseY - endY) ** 2);
        if (distance <= circleRadius) {
            dragging = true;
        }
    });

    // Handle mouse move event
    canvas.addEventListener('mousemove', (e) => {
        if (dragging) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // Calculate the angle based on the mouse position relative to the base of the line
            const dx = mouseX - baseX;
            const dy = baseY - mouseY;
            angle = Math.atan2(dy, dx);

            // Constrain the angle between 0 and Math.PI (0 to 180 degrees)
            if (angle < 0) angle = 0;
            if (angle > Math.PI) angle = Math.PI;

            updateColor();
            drawLineWithCircle();
        }
    });

    // Handle mouse up event
    canvas.addEventListener('mouseup', () => {
        dragging = false;
    });

    // Handle mouse leave (in case the user releases the mouse outside the canvas)
    canvas.addEventListener('mouseleave', () => {
        dragging = false;
    });

    // Initial draw
    drawLineWithCircle();
</script>

</body>
</html>
